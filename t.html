<head>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<title> Talon </title>
	<link rel="icon" type="image/png" href="favicon.png" />
	<script type="text/javascript" src="js/talon.js"></script>
    <script type="text/javascript"
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAd1awIlzqSWUk8mAXj2BhCc6qn_dvjxlM">
	</script>
	<script type="text/javascript">
		var initial = window.location.search.substr(1) || "%25E2%2599%2581%25E9%2585%258E%25EE%258F%2599%25E2%25BC%25B3%25E5%25A2%259D"
		initial = decodeURI(decodeURI(decodeURI(decodeURI(escape(encodeURI(initial))))))
		var map
		var marker
		var latlng = new google.maps.LatLng(43.7866457, -79.1894173)
		function current_url() {
			return location.protocol + '//' + location.host + location.pathname
				+ "?"
		}
		function initialize() {
			document.getElementById("talon-tag").value = current_url() + (encode(43.7866457, -79.1894173))
			var mapOptions = {
				center: latlng,
				zoom: 16
			};
			map = new google.maps.Map(document.getElementById('map-canvas'),
				mapOptions);
			marker = new google.maps.Marker({
				position: latlng,
				draggable: true,
				map: map,
				title: "Talon Tag",
				animation: google.maps.Animation.DROP,
			});
			map.setCenter(marker.getPosition());
			google.maps.event.addListener(marker, 'mouseup', function() {
				var position = marker.getPosition()
				map.panTo(position);
				var encoded = encode(position.lat(), position.lng());
				document.getElementById("talon-tag").value = current_url() + encoded
				window.history.pushState("object or string", "Title", "?" +	encoded);
			});
			pos = decode(initial)
			if (pos != -1) {
				pos = new google.maps.LatLng(pos[0], pos[1])
				marker.setPosition(pos)
				map.panTo(pos);
				document.getElementById("talon-tag").value = current_url() + (initial)
			}
		}

		google.maps.event.addDomListener(window, 'load', initialize);
	</script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
				Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-54739310-1', 'auto');
		ga('send', 'pageview');
	</script>
</head
<body>
	<div id="map-canvas"></div>	
	<div style="left: 50%; position: absolute;">
		<input type="text" id="talon-tag">
	</div>
</body>
